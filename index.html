<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Calculadora de Vinilo para Coches</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#3498db" />
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 900px; margin: auto; }
    select, input, button { display: block; margin: 10px 0; padding: 8px; width: 100%; }
    .modelo-info img { max-width: 300px; margin: 10px 0; }
    .resultado { margin-top: 20px; padding: 10px; background: #f4f4f4; border-left: 4px solid #4CAF50; }
  </style>
</head>
<body>
  <h1>Calculadora de Vinilado</h1>
  <label for="marca">Marca:</label>
  <select id="marca" onchange="cargarModelos()">
    <option value="">-- Selecciona marca --</option>
  </select>
  <label for="modelo">Modelo:</label>
  <select id="modelo" onchange="mostrarDatosModelo()">
    <option value="">-- Selecciona modelo --</option>
  </select>
  <div class="modelo-info" id="modeloInfo"></div>
  <label for="tipoVinil">Tipo de vinilo:</label>
  <select id="tipoVinil">
    <option value="standard">Vinilo estándar (€15/m²)</option>
    <option value="premium">Vinilo premium (€25/m²)</option>
    <option value="cambioColor">Cambio de color (€30/m²)</option>
    <option value="personalizado">Personalizado (€35/m²)</option>
  </select>
  <label for="horasTrabajo">Horas estimadas:</label>
  <input type="number" id="horasTrabajo" value="20" />
  <label for="tarifaHora">Tarifa por hora (€):</label>
  <input type="number" id="tarifaHora" value="30" />
  <label for="anchoVinilo">Ancho del vinilo (m):</label>
  <input type="number" id="anchoVinilo" value="1.52" step="0.01" />
  <button onclick="calcularPresupuesto()">Calcular Presupuesto</button>
  <div class="resultado" id="resultado"></div>

  <script>
    let datosVehiculos = {};
    let modelosActuales = [];

    fetch('vehiculos_combinado_convertido.json')
      .then(res => res.json())
      .then(data => {
        datosVehiculos = data;
        const selectMarca = document.getElementById('marca');
        data.marcas.forEach(marca => {
          const option = document.createElement('option');
          option.value = marca.nombre;
          option.textContent = marca.nombre;
          selectMarca.appendChild(option);
        });
      });

    function cargarModelos() {
      const marcaSel = document.getElementById('marca').value;
      const modeloSel = document.getElementById('modelo');
      modeloSel.innerHTML = '<option value="">-- Selecciona modelo --</option>';
      const marcaData = datosVehiculos.marcas.find(m => m.nombre === marcaSel);
      modelosActuales = marcaData ? marcaData.modelos : [];
      modelosActuales.forEach((modelo, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = modelo.nombre + (modelo.subtitulo ? " - " + modelo.subtitulo : "");
        modeloSel.appendChild(option);
      });
      document.getElementById("modeloInfo").innerHTML = "";
      document.getElementById("resultado").innerHTML = "";
    }

    function mostrarDatosModelo() {
      const index = document.getElementById('modelo').value;
      const modelo = modelosActuales[index];
      if (!modelo) return;
      const { dimensiones, imagen } = modelo;
      document.getElementById("modeloInfo").innerHTML = `
        <h3>${modelo.nombre} ${modelo.subtitulo || ""}</h3>
        <p>Largo: ${dimensiones.largo}, Ancho: ${dimensiones.ancho}, Alto: ${dimensiones.alto}</p>
        ${imagen ? `<img src="${imagen}" alt="${modelo.nombre}"/>` : ""}
      `;
      document.getElementById("resultado").innerHTML = "";
    }

    function limpiarNumero(valor) {
      return parseFloat(valor.replace(/[^\d.,]/g, '').replace(',', '.'));
    }

    function calcularPresupuesto() {
      const index = document.getElementById('modelo').value;
      const modelo = modelosActuales[index];
      if (!modelo) return;
      const tipoVinil = document.getElementById('tipoVinil').value;
      const horas = parseFloat(document.getElementById('horasTrabajo').value);
      const tarifa = parseFloat(document.getElementById('tarifaHora').value);
      const anchoVinilo = parseFloat(document.getElementById('anchoVinilo').value);
      const largo = limpiarNumero(modelo.dimensiones.largo) / 1000;
      const ancho = limpiarNumero(modelo.dimensiones.ancho) / 1000;
      const alto  = limpiarNumero(modelo.dimensiones.alto) / 1000;
      const areaSuperficial = 0.8 * (2 * (largo * alto + ancho * alto) + largo * ancho);
      const areaVinilo = areaSuperficial;
      const metrosLineales = areaVinilo / anchoVinilo;
      const precios = {
        standard: 15,
        premium: 25,
        cambioColor: 30,
        personalizado: 35
      };
      const costeMaterial = areaVinilo * precios[tipoVinil];
      const costeManoObra = horas * tarifa;
      const total = costeMaterial + costeManoObra;
      document.getElementById('resultado').innerHTML = `
        <h3>Presupuesto Estimado</h3>
        <p>Área vinilo: ${areaVinilo.toFixed(2)} m²</p>
        <p>Metros lineales: ${metrosLineales.toFixed(2)} m</p>
        <p>Coste materiales: ${costeMaterial.toFixed(2)} €</p>
        <p>Coste mano de obra: ${costeManoObra.toFixed(2)} €</p>
        <p><strong>Total: ${total.toFixed(2)} €</strong></p>
      `;
    }
  </script>
</body>
</html>
