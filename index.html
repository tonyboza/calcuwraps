
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora de Vinilo para Coches</title>
  <style>
    :root {
      --primary-color: #e74c3c;
      --primary-hover: #c0392b;
      --secondary-color: #2c3e50;
      --light-gray: #f3f3f3;
      --medium-gray: #ecf0f1;
      --dark-gray: #7f8c8d;
      --success-color: #27ae60;
    }

    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--light-gray);
      margin: 0; padding: 0; color: var(--secondary-color); line-height: 1.6;
    }

    .header-logos {
      background: white; padding: 15px 5%;
      display: flex; justify-content: space-between; align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .header-logos img {
      height: 80px; object-fit: contain; max-width: 200px;
    }

    .header-logos .center-logo {
      flex-grow: 1; text-align: center;
    }

    .container {
      max-width: 1000px; margin: 30px auto; background: white;
      padding: 40px; border-radius: 12px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.08);
    }

    h1 {
      text-align: center; color: var(--secondary-color);
      margin-bottom: 30px; font-size: 28px; position: relative;
      padding-bottom: 15px;
    }

    h1:after {
      content: ""; position: absolute; bottom: 0; left: 50%;
      transform: translateX(-50%); width: 100px; height: 3px;
      background: var(--primary-color);
    }

    .form-group { margin-bottom: 25px; }
    label {
      font-weight: 600; display: block;
      margin-bottom: 8px; color: var(--secondary-color);
    }

    select, input {
      width: 100%; padding: 12px 15px;
      border: 1px solid #ddd; border-radius: 8px;
      font-size: 16px; background-color: white;
    }

    button {
      display: block; width: 100%; padding: 15px;
      background: var(--primary-color); color: white;
      border: none; border-radius: 8px;
      font-size: 18px; font-weight: 600; cursor: pointer;
    }

    button:hover { background: var(--primary-hover); }

    .resultado {
      margin-top: 40px; padding: 25px;
      background: var(--medium-gray);
      border-left: 5px solid var(--success-color);
      border-radius: 8px; display: none;
    }

    .resultado h3 {
      margin-top: 0; color: var(--secondary-color);
      border-bottom: 1px solid #ddd; padding-bottom: 10px;
    }

    .price-item {
      display: flex; justify-content: space-between;
      padding: 8px 0; border-bottom: 1px solid #eee;
    }

    .price-item:last-child {
      border-bottom: none; font-weight: 600;
      font-size: 18px; color: var(--secondary-color);
    }

    @media (max-width: 768px) {
      .container { padding: 20px; margin: 20px 10px; }
      .header-logos img { height: 60px; }
    }
  </style>
</head>
<body>
  <div class="header-logos">
    <img src="img/gsix9.png" alt="GSIX9 Logo">
    <div class="center-logo"><img src="img/oracal.png" alt="ORACAL Logo"></div>
    <img src="img/totenser.png" alt="TOTENSER Logo">
  </div>

  <div class="container">
    <h1>Calculadora de Vinilo para Coches</h1>
    <div class="form-group"><label for="marca">Marca:</label><select id="marca" onchange="cargarModelos()"><option value="">Selecciona una marca</option></select></div>
    <div class="form-group"><label for="modelo">Modelo:</label><select id="modelo" onchange="mostrarDatosModelo()" disabled><option value="">Primero selecciona una marca</option></select></div>
    <div class="form-group"><label for="tipoVinilo">Tipo de vinilo:</label><select id="tipoVinilo"><option value="15">Vinilo estándar (€15/m²)</option><option value="25">Vinilo premium (€25/m²)</option><option value="30">Cambio de color (€30/m²)</option><option value="35">Personalizado (€35/m²)</option></select></div>
    <div class="form-group"><label for="dificultad">Dificultad del trabajo:</label><select id="dificultad"><option value="1">Fácil (x1.0)</option><option value="1.2">Media (x1.2)</option><option value="1.5">Difícil (x1.5)</option></select></div>
    <div class="form-group"><label for="horas">Horas estimadas:</label><input id="horas" type="number" value="20" /></div>
    <div class="form-group"><label for="tarifa">Tarifa por hora (€):</label><input id="tarifa" type="number" value="30" /></div>
    <div class="form-group"><label for="anchoVinilo">Ancho del vinilo (m):</label><input id="anchoVinilo" type="number" step="0.01" value="1.52" /></div>
    <button onclick="calcularPresupuesto()">Calcular Presupuesto</button>
    <div class="resultado" id="resultado">
      <h3>Resumen del Presupuesto</h3>
      <div class="price-item"><span>Área estimada:</span><span id="areaResultado">0.00 m²</span></div>
      <div class="price-item"><span>Metros lineales:</span><span id="metrosResultado">0.00 m</span></div>
      <div class="price-item"><span>Coste material:</span><span id="materialResultado">0.00 €</span></div>
      <div class="price-item"><span>Coste mano de obra:</span><span id="manoObraResultado">0.00 €</span></div>
      <div class="price-item"><span>Total estimado:</span><span id="totalResultado">0.00 €</span></div>
    </div>
  </div>

  <script>
    let datosVehiculos = {};
    let modelosActuales = [];

    async function cargarDatos() {
      try {
        const response = await fetch('vehiculos_combinado_convertido.json');
        if (!response.ok) throw new Error("No se pudo cargar el archivo JSON");
        datosVehiculos = await response.json();

        const marcas = datosVehiculos.marcas.sort((a, b) => a.nombre.localeCompare(b.nombre));
        const selectMarca = document.getElementById("marca");
        marcas.forEach(marca => {
          const opt = document.createElement("option");
          opt.value = marca.nombre;
          opt.textContent = marca.nombre;
          selectMarca.appendChild(opt);
        });
      } catch (error) {
        alert("Error al cargar los datos de vehículos.");
        console.error(error);
      }
    }

    function cargarModelos() {
      const marcaSeleccionada = document.getElementById("marca").value;
      const selectModelo = document.getElementById("modelo");
      const marca = datosVehiculos.marcas.find(m => m.nombre === marcaSeleccionada);
      modelosActuales = marca.modelos;
      selectModelo.innerHTML = '<option value="">Selecciona un modelo</option>';
      modelosActuales.forEach((modelo, index) => {
        const opt = document.createElement("option");
        opt.value = index;
        opt.textContent = modelo.nombre + (modelo.subtitulo ? ` (${modelo.subtitulo})` : "");
        selectModelo.appendChild(opt);
      });
      selectModelo.disabled = false;
    }

    function mostrarDatosModelo() {
      document.getElementById("resultado").style.display = "none";
    }

    function limpiarNumero(valor) {
      if (typeof valor !== "string") return parseFloat(valor) || 0;
      return parseFloat(valor.replace(/[^0-9.]/g, "")) || 0;
    }

    function calcularPresupuesto() {
      const index = document.getElementById("modelo").value;
      if (index === "") return;

      const modelo = modelosActuales[index];
      const largoTotal = limpiarNumero(modelo.dimensiones.largo) / 1000;
      const anchoTotal = limpiarNumero(modelo.dimensiones.ancho) / 1000;
      const anchoVinilo = parseFloat(document.getElementById("anchoVinilo").value) || 1.52;

      const FACTORES = { ALETAS: 0.28, CAPO: 0.45, TECHO: 0.55, PORTON: 0.35, MARGEN_ERROR: 1.12 };
      const aletas = largoTotal * FACTORES.ALETAS;
      const laterales = (largoTotal - aletas) * 2 * FACTORES.MARGEN_ERROR;
      const parachoques = Math.max(anchoTotal * 1.2, anchoTotal * 0.9) * FACTORES.MARGEN_ERROR;
      const piezasGrandes = (largoTotal * (FACTORES.CAPO + FACTORES.TECHO + FACTORES.PORTON)) * FACTORES.MARGEN_ERROR;

      const mlTotales = laterales + parachoques + piezasGrandes;
      const areaTotal = (laterales + parachoques) * (anchoVinilo/2) + piezasGrandes * anchoVinilo;

      const tipoPrecio = parseFloat(document.getElementById("tipoVinilo").value) || 15;
      const dificultad = parseFloat(document.getElementById("dificultad").value) || 1;
      const horas = parseFloat(document.getElementById("horas").value) || 20;
      const tarifa = parseFloat(document.getElementById("tarifa").value) || 30;

      const costeMaterial = areaTotal * tipoPrecio;
      const costeTrabajo = horas * tarifa * dificultad;
      const total = costeMaterial + costeTrabajo;

      document.getElementById("areaResultado").textContent = areaTotal.toFixed(2) + " m²";
      document.getElementById("metrosResultado").textContent = mlTotales.toFixed(2) + " m";
      document.getElementById("materialResultado").textContent = costeMaterial.toFixed(2) + " €";
      document.getElementById("manoObraResultado").textContent = costeTrabajo.toFixed(2) + " €";
      document.getElementById("totalResultado").textContent = total.toFixed(2) + " €";

      document.getElementById("resultado").style.display = "block";
    }

    window.onload = cargarDatos;
  </script>
</body>
</html>
