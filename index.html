<!DOCTYPE html>
<html lang="es">
<!-- [HEAD y CSS igual que antes] -->
<body>
  <!-- [Todo el HTML anterior igual hasta el div.resultado] -->

  <div class="resultado" id="resultado">
    <h3>Resumen del Presupuesto</h3>
    <div class="price-item">
      <span>Área estimada:</span>
      <span id="areaResultado">0.00 m²</span>
    </div>
    <div class="price-item">
      <span>Metros lineales:</span>
      <span id="metrosResultado">0.00 m</span>
    </div>
    <div class="price-item">
      <span>Coste material:</span>
      <span id="materialResultado">0.00 €</span>
    </div>
    <div class="price-item">
      <span>Coste mano de obra:</span>
      <span id="manoObraResultado">0.00 €</span>
    </div>
    <div class="price-item">
      <span>Total estimado:</span>
      <span id="totalResultado">0.00 €</span>
    </div>
    <!-- Añadido: Aviso sobre margen de error -->
    <div style="margin-top: 20px; padding: 10px; background: #fff8e1; border-left: 4px solid #ffc107; font-size: 14px;">
      <strong>Nota:</strong> Este cálculo incluye un margen base. Para trabajos complejos, 
      considere añadir un <strong>10-15% adicional</strong> en metros lineales para cubrir 
      posibles errores o piezas especiales.
    </div>
  </div>

  <script>
    // [Funciones cargarDatos(), cargarModelos(), etc. iguales hasta calcularPresupuesto()]

    function calcularPresupuesto() {
      const index = document.getElementById("modelo").value;
      if (index === "") {
        alert("Por favor, selecciona un modelo de vehículo");
        return;
      }

      const modelo = modelosActuales[index];
      
      try {
        // 1. Obtener dimensiones
        const largoTotal = limpiarNumero(modelo.dimensiones.largo) / 1000;
        const anchoTotal = limpiarNumero(modelo.dimensiones.ancho) / 1000;
        const anchoVinilo = parseFloat(document.getElementById("anchoVinilo").value) || 1.52;

        // 2. Factores de proporcionalidad (ajustables)
        const FACTORES = {
          ALETAS: 0.28,    // 28% del largo para aletas
          CAPO: 0.45,      // 45% del largo para capó
          TECHO: 0.55,     // 55% del largo para techo
          PORTON: 0.35,    // 35% del largo para portón
          MARGEN_ERROR: 1.12 // 12% de margen adicional
        };

        // 3. Cálculo proporcional
        const aletas = largoTotal * FACTORES.ALETAS;
        const laterales = (largoTotal - aletas) * 2 * FACTORES.MARGEN_ERROR;
        const parachoques = Math.max(anchoTotal * 1.2, anchoTotal * 0.9) * FACTORES.MARGEN_ERROR;
        
        const piezasGrandes = (
          (largoTotal * FACTORES.CAPO) + 
          (largoTotal * FACTORES.TECHO) + 
          (largoTotal * FACTORES.PORTON)
        ) * FACTORES.MARGEN_ERROR;

        // 4. Totales
        const mlTotales = laterales + parachoques + piezasGrandes;
        const areaTotal = (laterales + parachoques) * (anchoVinilo/2) + piezasGrandes * anchoVinilo;

        // 5. Costes (resto del código igual)
        const tipoPrecio = parseFloat(document.getElementById("tipoVinilo").value) || 15;
        const dificultad = parseFloat(document.getElementById("dificultad").value) || 1;
        const horas = parseFloat(document.getElementById("horas").value) || 20;
        const tarifa = parseFloat(document.getElementById("tarifa").value) || 30;
        
        const costeMaterial = areaTotal * tipoPrecio;
        const costeTrabajo = horas * tarifa * dificultad;
        const total = costeMaterial + costeTrabajo;

        // Mostrar resultados
        document.getElementById("areaResultado").textContent = areaTotal.toFixed(2) + " m²";
        document.getElementById("metrosResultado").textContent = mlTotales.toFixed(2) + " m";
        document.getElementById("materialResultado").textContent = costeMaterial.toFixed(2) + " €";
        document.getElementById("manoObraResultado").textContent = costeTrabajo.toFixed(2) + " €";
        document.getElementById("totalResultado").textContent = total.toFixed(2) + " €";

        document.getElementById("resultado").style.display = "block";

      } catch (error) {
        console.error("Error en el cálculo:", error);
        alert(`Error al calcular: ${error.message}`);
      }
    }

    // [Resto de funciones iguales]
  </script>
</body>
</html>
